<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Irreverent Warriors – State Map</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    /* =======================
       BRAND COLORS & TYPOGRAPHY
       ======================= */
    @import url('https://fonts.googleapis.com/css2?family=Sofia+Sans:wght@400;600&display=swap');
    @import url('https://fonts.googleapis.com/css2?family=Lambada:wght@400;700&display=swap');
    @import url('https://fonts.googleapis.com/css2?family=Shantell+Sans:wght@700&display=swap'); /* temporary sub for Shara Stencil */

    :root {
      /* Primary */
      --black: #000000;
      --paperwork: #E6E6E1;
      --olive: #4A5E41;

      /* Secondary */
      --gunmetal: #585C5E;
      --sandstorm: #BBA854;
      --fieldgreen: #3B7A57;

      /* Accent */
      --deepsea: #2D409F;
      --goldstar: #E6B300;
      --crimson: #B60000;

      /* Map theme */
      --bg: var(--black);
      --panel: #111;
      --text: var(--paperwork);
      --muted: #cfcfcf;
      --state: var(--olive);
      --state-hover: var(--fieldgreen);
      --stroke: var(--gunmetal);
      --stroke-strong: var(--sandstorm);
      --focus: var(--goldstar);
    }

    body {
      margin: 0;
      background: var(--bg);
      color: var(--text);
      font-family: 'Sofia Sans', sans-serif;
      -webkit-font-smoothing: antialiased;
    }

    .wrap {
      max-width: 1100px;
      margin: 30px auto;
      padding: 0 16px;
      text-align: center;
    }

    h1 {
      font-family: 'Shantell Sans', sans-serif;
      font-size: 2rem;
      letter-spacing: 1px;
      color: var(--goldstar);
      margin-bottom: 8px;
    }

    p.helper {
      font-family: 'Lambada', sans-serif;
      color: var(--muted);
      margin-bottom: 20px;
    }

    .map-wrap {
      position: relative;
      background: var(--panel);
      border-radius: 16px;
      padding: 14px;
      box-shadow: 0 0 30px rgba(230, 179, 0, 0.25);
    }

    svg {
      width: 100%;
      height: auto;
      display: block;
      border-radius: 10px;
    }

    .state {
      fill: var(--state);
      stroke: var(--stroke);
      stroke-width: 0.8;
      cursor: pointer;
      transition: fill 140ms ease, stroke 140ms ease, transform 120ms ease;
    }

    .state:hover,
    .state:focus {
      fill: var(--state-hover);
      stroke: var(--stroke-strong);
      outline: none;
    }

    .state:focus-visible {
      filter: drop-shadow(0 0 0.5px var(--focus)) drop-shadow(0 0 7px var(--focus));
    }

    .tip {
      position: absolute;
      pointer-events: none;
      background: var(--deepsea);
      color: #fff;
      padding: 6px 8px;
      border-radius: 6px;
      font-size: 12px;
      transform: translate(-50%, -120%);
      white-space: nowrap;
      opacity: 0;
      transition: opacity 120ms ease;
      border: 1px solid rgba(255,255,255,.15);
    }

    .note {
      color: var(--muted);
      font-size: 0.85rem;
      margin-top: 10px;
    }

    .note code {
      color: var(--sandstorm);
    }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Find Your State</h1>
    <p class="helper">Click your state to open its Irreverent Warriors DonorDrive page.</p>

    <div class="map-wrap" id="mapWrap">
      <div class="tip" id="tip"></div>
      <svg id="usMap" viewBox="0 0 975 610" role="img" aria-labelledby="title desc">
        <title id="title">United States Map – Clickable States</title>
        <desc id="desc">Click a state to visit its Irreverent Warriors DonorDrive page.</desc>
      </svg>
      <p class="note">Links go to <code>https://irreverentwarriors.donordrive.com/&lt;statename&gt;</code></p>
    </div>
  </div>

  <script src="https://unpkg.com/d3@7"></script>
  <script src="https://unpkg.com/topojson-client@3"></script>

  <script>
    const BASE = "https://irreverentwarriors.donordrive.com";
    const OPEN_IN_NEW_TAB = true;
    const slugOverrides = {};

    const FIFTY_STATES = new Set([
      "Alabama","Alaska","Arizona","Arkansas","California","Colorado","Connecticut","Delaware","Florida","Georgia",
      "Hawaii","Idaho","Illinois","Indiana","Iowa","Kansas","Kentucky","Louisiana","Maine","Maryland",
      "Massachusetts","Michigan","Minnesota","Mississippi","Missouri","Montana","Nebraska","Nevada","New Hampshire","New Jersey",
      "New Mexico","New York","North Carolina","North Dakota","Ohio","Oklahoma","Oregon","Pennsylvania","Rhode Island","South Carolina",
      "South Dakota","Tennessee","Texas","Utah","Vermont","Virginia","Washington","West Virginia","Wisconsin","Wyoming"
    ]);

    const slugify = (name) => {
      if (slugOverrides[name]) return slugOverrides[name];
      return name.toLowerCase().replace(/[^a-z0-9]/g, "");
    };

    const svg = d3.select("#usMap");
    const tip = document.getElementById("tip");
    const wrap = document.getElementById("mapWrap");
    const projection = d3.geoAlbersUsa().translate([487.5, 305]).scale(1280);
    const path = d3.geoPath(projection);

    function go(url) {
      if (OPEN_IN_NEW_TAB) window.open(url, "_blank", "noopener");
      else window.location.href = url;
    }

    function getOffsets(evt) {
      if (typeof evt.offsetX === "number") return { x: evt.offsetX, y: evt.offsetY };
      const r = wrap.getBoundingClientRect();
      return { x: evt.clientX - r.left, y: evt.clientY - r.top };
    }

    fetch("https://unpkg.com/us-atlas@3/states-10m.json")
      .then(r => r.json())
      .then(us => {
        const states = topojson.feature(us, us.objects.states).features.filter(f => FIFTY_STATES.has(f.properties.name));

        svg.append("g")
          .selectAll("path")
          .data(states)
          .join("path")
          .attr("class", "state")
          .attr("d", path)
          .attr("tabindex", 0)
          .attr("role", "link")
          .attr("aria-label", d => d.properties.name)
          .on("click", (_, d) => go(`${BASE}/${slugify(d.properties.name)}`))
          .on("keydown", (event, d) => {
            if (event.key === "Enter" || event.key === " ") go(`${BASE}/${slugify(d.properties.name)}`);
          })
          .on("mousemove", (event, d) => {
            const { x, y } = getOffsets(event);
            tip.textContent = d.properties.name;
            tip.style.left = x + "px";
            tip.style.top = y + "px";
            tip.style.opacity = 1;
          })
          .on("mouseleave", () => tip.style.opacity = 0);

        const mesh = topojson.mesh(us, us.objects.states, (a, b) => a !== b);
        svg.append("path")
          .attr("fill", "none")
          .attr("stroke", getComputedStyle(document.documentElement).getPropertyValue('--stroke-strong').trim() || "#BBA854")
          .attr("stroke-width", 0.7)
          .attr("pointer-events", "none")
          .attr("d", path(mesh));
      })
      .catch(err => console.error("Failed to load map data:", err));
  </script>
</body>
</html>
