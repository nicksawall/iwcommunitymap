<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Irreverent Warriors – State & OCONUS Map</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    /* Fonts */
    @import url('https://fonts.googleapis.com/css2?family=Sofia+Sans:wght@400;600;800&display=swap');
    @import url('https://fonts.googleapis.com/css2?family=Lambada:wght@400;700&display=swap');

    /* IW Brand Palette */
    :root{
      --black:#000000;
      --paperwork:#E6E6E1;
      --olive:#4A5E41;
      --gunmetal:#585C5E;
      --sandstorm:#BBA854;
      --fieldgreen:#3B7A57;
      --deepsea:#2D409F;
      --goldstar:#E6B300;
      --crimson:#B60000;

      --bg:var(--black);
      --panel:#111;
      --text:var(--paperwork);
      --muted:#cfcfcf;

      --state:var(--olive);
      --state-hover:var(--deepsea);
      --stroke:var(--gunmetal);
      --stroke-strong:var(--goldstar);
      --focus:var(--goldstar);
      --link:var(--goldstar);
      --link-hover:#ffd34d;
    }

    /* Base */
    body{
      margin:0;
      background:var(--bg);
      color:var(--text);
      font-family:'Sofia Sans',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      -webkit-font-smoothing:antialiased;
    }
    a{color:var(--link);text-decoration:none}
    a:hover{color:var(--link-hover);text-decoration:underline}

    .wrap{max-width:1100px;margin:28px auto 40px;padding:0 16px}
    h1{
      margin:0 0 6px;
      font-weight:800;
      font-size:2rem; /* Sofia Sans as requested */
    }
    p.helper{margin:0 0 16px;color:var(--muted);font-family:'Lambada',sans-serif}

    .map-wrap{
      position:relative;background:var(--panel);
      border-radius:16px;padding:14px;
      box-shadow:0 8px 28px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.03);
    }
    svg{width:100%;height:auto;display:block;border-radius:10px}

    .state,.inset-geom{
      fill:var(--state);
      stroke:var(--stroke);
      stroke-width:.8;
      cursor:pointer;
      transition:fill .14s ease, stroke .14s ease;
    }
    .state:hover,.state:focus,
    .inset-geom:hover,.inset-geom:focus{
      fill:var(--state-hover);
      stroke:var(--stroke-strong);
      outline:none;
    }
    .inset-box{
      fill:rgba(255,255,255,.02);
      stroke:rgba(255,255,255,.15);
      stroke-width:.8;
    }
    .inset-title{
      font-size:12px;
      fill:var(--paperwork);
      opacity:.85;
      pointer-events:none;
    }
    .inset-point{
      fill:var(--goldstar);
      stroke:var(--stroke);
      stroke-width:.8;
      cursor:pointer;
      transition:transform .12s ease;
    }
    .inset-point:hover{transform:scale(1.1)}
    .state:focus-visible,.inset-geom:focus-visible{
      filter:drop-shadow(0 0 .5px var(--focus)) drop-shadow(0 0 7px var(--focus));
    }

    .tip{
      position:absolute;pointer-events:none;background:rgba(15,23,42,.96);
      color:#fff;padding:6px 8px;border-radius:6px;font-size:12px;
      transform:translate(-50%,-120%);white-space:nowrap;opacity:0;
      transition:opacity .12s ease;border:1px solid rgba(255,255,255,.12);
    }

    .note{color:var(--muted);font-size:.9rem;margin-top:10px}

    /* Directory lists */
    .directory{margin:22px 0 0;display:grid;gap:24px;}
    .dir-section h2{
      margin:0 0 8px;font-size:1.05rem;font-weight:700;color:var(--paperwork);
      border-left:4px solid var(--sandstorm);padding-left:8px;
    }
    .dir-grid{
      display:grid;gap:8px 18px;
      grid-template-columns:repeat(2,minmax(0,1fr));
    }
    @media (min-width:640px){.dir-grid{grid-template-columns:repeat(3,1fr)}}
    @media (min-width:900px){.dir-grid{grid-template-columns:repeat(4,1fr)}}
    .dir-grid a{
      padding:6px 8px;border-radius:6px;background:rgba(255,255,255,.03);
      border:1px solid rgba(255,255,255,.06);
      transition:background .12s ease,border-color .12s ease;
    }
    .dir-grid a:hover{
      background:rgba(255,255,255,.06);border-color:rgba(255,255,255,.18);
    }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Find your state</h1>
    <p class="helper">Find your state or OCONUS chapter to open its landing page.</p>

    <div class="map-wrap" id="mapWrap" aria-label="Clickable U.S. and OCONUS map">
      <div class="tip" id="tip" role="status" aria-live="polite"></div>
      <svg id="usMap" viewBox="0 0 975 740" role="img" aria-labelledby="title desc">
        <title id="title">USA map with OCONUS insets</title>
        <desc id="desc">Click states or OCONUS insets to open Irreverent Warriors DonorDrive pages.</desc>
        <!-- Main US map fits in ~975x610; we extend height for insets row -->
      </svg>
      <p class="note">Links go to <code>https://irreverentwarriors.donordrive.com/&lt;name&gt;</code> (e.g., <code>northcarolina</code>, <code>guam</code>).</p>
    </div>

    <!-- Directory lists -->
    <div class="directory" id="directory">
      <section class="dir-section">
        <h2>States</h2>
        <div class="dir-grid" id="statesList"></div>
      </section>
      <section class="dir-section">
        <h2>OCONUS</h2>
        <div class="dir-grid" id="oconusList"></div>
      </section>
    </div>
  </div>

  <!-- D3 + TopoJSON -->
  <script src="https://unpkg.com/d3@7"></script>
  <script src="https://unpkg.com/topojson-client@3"></script>

  <script>
    // ---------- CONFIG ----------
    const BASE = "https://irreverentwarriors.donordrive.com";
    const OPEN_IN_NEW_TAB = true;

    const OCONUS = [
      { name: "England", slug: "england" },
      { name: "France", slug: "france" },
      { name: "Germany", slug: "germany" },
      { name: "Puerto Rico", slug: "puertorico" },
      { name: "St Thomas", slug: "stthomas" },
      { name: "Guam", slug: "guam" }
    ];

    const FIFTY_STATES = [
      "Alabama","Alaska","Arizona","Arkansas","California","Colorado","Connecticut","Delaware","Florida","Georgia",
      "Hawaii","Idaho","Illinois","Indiana","Iowa","Kansas","Kentucky","Louisiana","Maine","Maryland",
      "Massachusetts","Michigan","Minnesota","Mississippi","Missouri","Montana","Nebraska","Nevada","New Hampshire","New Jersey",
      "New Mexico","New York","North Carolina","North Dakota","Ohio","Oklahoma","Oregon","Pennsylvania","Rhode Island","South Carolina",
      "South Dakota","Tennessee","Texas","Utah","Vermont","Virginia","Washington","West Virginia","Wisconsin","Wyoming"
    ];

    const slugify = s => s.toLowerCase().replace(/&/g,"and").replace(/[^a-z0-9]/g,"");

    const tip = document.getElementById("tip");
    const wrap = document.getElementById("mapWrap");
    const svg = d3.select("#usMap");
    const mainGroup = svg.append("g").attr("id","mainUS");
    const insetsGroup = svg.append("g").attr("id","insets");

    const go = url => OPEN_IN_NEW_TAB ? window.open(url,"_blank","noopener") : (window.location.href=url);
    const offsets = evt => {
      if (typeof evt.offsetX === "number") return {x:evt.offsetX,y:evt.offsetY};
      const r = wrap.getBoundingClientRect();
      return {x:evt.clientX - r.left, y:evt.clientY - r.top};
    };

    // Layout for insets (positions within the 975x740 viewBox)
    const insetLayout = {
      europe: { x0: 25,  y0: 625, x1: 325, y1: 730, title: "Europe" },
      carib:  { x0: 345, y0: 625, x1: 645, y1: 730, title: "Caribbean" },
      pac:    { x0: 665, y0: 625, x1: 965, y1: 730, title: "Pacific" }
    };

    // Projections
    const projUS = d3.geoAlbersUsa().translate([487.5, 305]).scale(1280);
    const pathUS = d3.geoPath(projUS);

    // Load both US (states) and world (countries/land)
    Promise.all([
      fetch("https://unpkg.com/us-atlas@3/states-10m.json").then(r=>r.json()),
      fetch("https://unpkg.com/world-atlas@2/countries-110m.json").then(r=>r.json()),
      fetch("https://unpkg.com/world-atlas@2/land-110m.json").then(r=>r.json())
    ]).then(([usTopo, worldCountriesTopo, worldLandTopo]) => {
      // ----- Main US map -----
      const statesAll = topojson.feature(usTopo, usTopo.objects.states).features
        .filter(f => FIFTY_STATES.includes(f.properties.name));

      mainGroup.append("g")
        .selectAll("path")
        .data(statesAll)
        .join("path")
        .attr("class","state")
        .attr("d", d => pathUS(d))
        .attr("tabindex", 0)
        .attr("role","link")
        .attr("aria-label", d => d.properties.name)
        .on("click", (_, d) => go(`${BASE}/${slugify(d.properties.name)}`))
        .on("keydown", (e, d) => {
          if (e.key === "Enter" || e.key === " ") {
            e.preventDefault();
            go(`${BASE}/${slugify(d.properties.name)}`);
          }
        })
        .on("mousemove", (e,d) => {
          const {x,y} = offsets(e);
          tip.textContent = d.properties.name;
          tip.style.left = x + "px";
          tip.style.top = y + "px";
          tip.style.opacity = 1;
        })
        .on("mouseleave", () => tip.style.opacity = 0);

      // Draw crisp internal borders
      const mesh = topojson.mesh(usTopo, usTopo.objects.states, (a,b) => a !== b);
      mainGroup.append("path")
        .attr("fill","none")
        .attr("stroke", getComputedStyle(document.documentElement).getPropertyValue('--sandstorm').trim() || "#BBA854")
        .attr("stroke-width", .7)
        .attr("pointer-events","none")
        .attr("d", d3.geoPath(projUS)(mesh));

      // ----- OCONUS Insets -----
      // Helpers for insets
      const box = (layout, parent) => {
        parent.append("rect")
          .attr("class","inset-box")
          .attr("x", layout.x0)
          .attr("y", layout.y0)
          .attr("width", layout.x1 - layout.x0)
          .attr("height", layout.y1 - layout.y0);
        parent.append("text")
          .attr("class","inset-title")
          .attr("x", layout.x0 + 8)
          .attr("y", layout.y0 + 16)
          .text(layout.title);
      };
      const fitProjection = (layout, fc) =>
        d3.geoMercator().fitExtent([[layout.x0+6, layout.y0+20], [layout.x1-6, layout.y1-6]], fc);
      const pathFor = proj => d3.geoPath(proj);

      // ---- Europe inset: UK (for England), France, Germany ----
      const europe = insetsGroup.append("g").attr("id","inset-europe");
      box(insetLayout.europe, europe);

      const countries = topojson.feature(worldCountriesTopo, worldCountriesTopo.objects.countries);
      // simple name lookup via a prebuilt map (world-atlas 110m uses numeric ids; we rely on external name map less here)
      // We'll filter by approximate geometries using known ISO-ish centroid longitudes/lat windows:
      // Instead, we derive by a rough bbox filter on Europe region then manually pick by name via a name property if available.
      // Many bundles include a .properties.name — if absent for some builds, this still renders (click areas labeled with our target names).

      // Build a small helper by scanning property names when present:
      const pickByName = (names) => {
        const out = [];
        for (const f of countries.features) {
          const n = (f.properties && (f.properties.name || f.properties.NAME || f.properties.admin)) || "";
          if (names.includes(n)) out.push(f);
        }
        return out;
      };
      let euTargets = pickByName(["United Kingdom","France","Germany"]);
      // Fallback: if names not found (rare), just use an empty FeatureCollection
      const euFC = { type:"FeatureCollection", features: euTargets };
      const projEU = fitProjection(insetLayout.europe, euFC);
      const pathEU = pathFor(projEU);

      europe.selectAll("path.country")
        .data(euFC.features.map(f => {
          const n = f.properties && (f.properties.name || f.properties.NAME || f.properties.admin);
          let label = n === "United Kingdom" ? "England" : n;
          let slug = slugify(label);
          return { geom:f, label, slug };
        }))
        .join("path")
        .attr("class","inset-geom")
        .attr("d", d => pathEU(d.geom))
        .attr("tabindex", 0)
        .attr("role","link")
        .attr("aria-label", d => d.label)
        .on("click", (_, d) => go(`${BASE}/${d.slug}`))
        .on("keydown", (e, d) => { if (e.key === "Enter" || e.key === " ") { e.preventDefault(); go(`${BASE}/${d.slug}`);} })
        .on("mousemove", (e,d) => { const {x,y}=offsets(e); tip.textContent=d.label; tip.style.left=x+"px"; tip.style.top=y+"px"; tip.style.opacity=1; })
        .on("mouseleave", () => tip.style.opacity=0);

      // ---- Caribbean inset: Puerto Rico (shape), St Thomas (point) ----
      const carib = insetsGroup.append("g").attr("id","inset-carib");
      box(insetLayout.carib, carib);

      const statesExtra = topojson.feature(usTopo, usTopo.objects.states).features;
      const pr = statesExtra.find(f => f.properties && f.properties.name === "Puerto Rico");
      const prFC = { type:"FeatureCollection", features: pr ? [pr] : [] };
      const projCarib = fitProjection(insetLayout.carib, prFC.features.length ? prFC : {type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"Point",coordinates:[-66.1,18.4]}}]});
      const pathCarib = pathFor(projCarib);

      if (pr) {
        carib.append("path")
          .datum({ geom: pr, label: "Puerto Rico", slug: "puertorico" })
          .attr("class","inset-geom")
          .attr("d", d => pathCarib(d.geom))
          .attr("tabindex", 0)
          .attr("role","link")
          .attr("aria-label","Puerto Rico")
          .on("click", () => go(`${BASE}/puertorico`))
          .on("keydown", e => { if (e.key==="Enter"||e.key===" "){ e.preventDefault(); go(`${BASE}/puertorico`);} })
          .on("mousemove", (e) => { const {x,y}=offsets(e); tip.textContent="Puerto Rico"; tip.style.left=x+"px"; tip.style.top=y+"px"; tip.style.opacity=1; })
          .on("mouseleave", () => tip.style.opacity=0);
      }

      // St Thomas approximate location (USVI; click as a dot)
      const stThomasLonLat = [-64.93, 18.33];
      const stt = projCarib(stThomasLonLat);
      if (stt) {
        carib.append("circle")
          .attr("class","inset-point")
          .attr("cx", stt[0]).attr("cy", stt[1]).attr("r", 4)
          .attr("tabindex", 0)
          .attr("role","link")
          .attr("aria-label","St Thomas")
          .on("click", () => go(`${BASE}/stthomas`))
          .on("keydown", e => { if (e.key==="Enter"||e.key===" "){ e.preventDefault(); go(`${BASE}/stthomas`);} })
          .on("mousemove", (e) => { const {x,y}=offsets(e); tip.textContent="St Thomas"; tip.style.left=x+"px"; tip.style.top=y+"px"; tip.style.opacity=1; })
          .on("mouseleave", () => tip.style.opacity=0);
      }

      // ---- Pacific inset: Guam (point) ----
      const pac = insetsGroup.append("g").attr("id","inset-pac");
      box(insetLayout.pac, pac);

      // A minimal land outline for context could be made from world land, but at 110m Guam is tiny;
      // we focus on a clickable point.
      const projPac = d3.geoMercator().fitExtent(
        [[insetLayout.pac.x0+6, insetLayout.pac.y0+20], [insetLayout.pac.x1-6, insetLayout.pac.y1-6]],
        { type:"FeatureCollection", features:[{type:"Feature",geometry:{type:"Point",coordinates:[144.7937,13.4443]}}] }
      );
      const gu = projPac([144.7937,13.4443]); // Guam
      if (gu) {
        pac.append("circle")
          .attr("class","inset-point")
          .attr("cx", gu[0]).attr("cy", gu[1]).attr("r", 4)
          .attr("tabindex", 0)
          .attr("role","link")
          .attr("aria-label","Guam")
          .on("click", () => go(`${BASE}/guam`))
          .on("keydown", e => { if (e.key==="Enter"||e.key===" "){ e.preventDefault(); go(`${BASE}/guam`);} })
          .on("mousemove", (e) => { const {x,y}=offsets(e); tip.textContent="Guam"; tip.style.left=x+"px"; tip.style.top=y+"px"; tip.style.opacity=1; })
          .on("mouseleave", () => tip.style.opacity=0);
      }

      // Build directory lists
      const statesList = document.getElementById("statesList");
      FIFTY_STATES.forEach(n => {
        const a = document.createElement("a");
        a.textContent = n;
        a.href = `${BASE}/${slugify(n)}`;
        if (OPEN_IN_NEW_TAB) a.target = "_blank";
        a.rel = "noopener";
        statesList.appendChild(a);
      });

      const oconusList = document.getElementById("oconusList");
      OCONUS.forEach(({name,slug}) => {
        const a = document.createElement("a");
        a.textContent = name;
        a.href = `${BASE}/${slug}`;
        if (OPEN_IN_NEW_TAB) a.target = "_blank";
        a.rel = "noopener";
        oconusList.appendChild(a);
      });
    }).catch(err => {
      console.error(err);
      alert("Failed to load map data. Please check your network and refresh.");
    });
  </script>
</body>
</html>
