<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Irreverent Warriors â€“ State & OCONUS Map</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    /* Fonts */
    @import url('https://fonts.googleapis.com/css2?family=Sofia+Sans:wght@400;600;800&display=swap');
    @import url('https://fonts.googleapis.com/css2?family=Lambada:wght@400;700&display=swap');

    /* IW Brand Palette */
    :root{
      --paperwork:#E6E6E1;
      --olive:#4A5E41;
      --gunmetal:#585C5E;
      --sandstorm:#BBA854;
      --deepsea:#2D409F;
      --goldstar:#E6B300;
      --background:#FFFFFF;
      --panel:#FFFFFF;
      --text:#1E1E1E;
      --muted:#444;
      --state:var(--olive);
      --state-hover:var(--deepsea);
      --stroke:var(--gunmetal);
      --stroke-strong:var(--goldstar);
      --focus:var(--goldstar);
      --link:var(--goldstar);
      --link-hover:#d4a200;
    }

    body{
      margin:0;
      background:var(--background);
      color:var(--text);
      font-family:'Sofia Sans',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      -webkit-font-smoothing:antialiased;
    }

    a{color:var(--link);text-decoration:none}
    a:hover{color:var(--link-hover);text-decoration:underline}

    .wrap{max-width:1100px;margin:28px auto 40px;padding:0 16px}
    h1{
      margin:0 0 6px;
      font-weight:800;
      font-size:2rem;
      color:var(--olive);
    }
    p.helper{margin:0 0 16px;color:var(--muted);font-family:'Lambada',sans-serif}

    .map-wrap{
      position:relative;
      background:var(--panel);
      border-radius:16px;
      padding:14px;
      box-shadow:0 6px 20px rgba(0,0,0,.12);
    }

    svg{width:100%;height:auto;display:block;border-radius:10px}

    .state,.inset-geom{
      fill:var(--state);
      stroke:var(--stroke);
      stroke-width:.8;
      cursor:pointer;
      transition:fill .14s ease, stroke .14s ease;
    }
    .state:hover,.inset-geom:hover{
      fill:var(--state-hover);
      stroke:var(--stroke-strong);
    }

    .inset-box{
      fill:rgba(74,94,65,.05);
      stroke:var(--olive);
      stroke-width:1;
    }
    .inset-title{
      font-size:12px;
      fill:var(--olive);
      opacity:.85;
      font-family:'Lambada',sans-serif;
    }

    .state:focus-visible,.inset-geom:focus-visible{
      filter:drop-shadow(0 0 1px var(--focus)) drop-shadow(0 0 7px var(--focus));
      outline:none;
    }

    .tip{
      position:absolute;
      pointer-events:none;
      background:rgba(15,23,42,.95);
      color:#fff;
      padding:6px 8px;
      border-radius:6px;
      font-size:12px;
      transform:translate(-50%,-120%);
      white-space:nowrap;
      opacity:0;
      transition:opacity .12s ease;
      border:1px solid rgba(255,255,255,.12);
    }

    /* Directory */
    .directory{margin:22px 0 0;display:grid;gap:24px;}
    .dir-section h2{
      margin:0 0 8px;
      font-size:1.05rem;
      font-weight:700;
      color:var(--olive);
      border-left:4px solid var(--sandstorm);
      padding-left:8px;
    }
    .dir-grid{
      display:grid;
      gap:8px 18px;
      grid-template-columns:repeat(2,minmax(0,1fr));
    }
    @media (min-width:640px){.dir-grid{grid-template-columns:repeat(3,1fr)}}
    @media (min-width:900px){.dir-grid{grid-template-columns:repeat(4,1fr)}}
    .dir-grid a{
      padding:6px 8px;
      border-radius:6px;
      background:rgba(74,94,65,.06);
      border:1px solid rgba(74,94,65,.12);
      transition:background .12s ease,border-color .12s ease;
    }
    .dir-grid a:hover{
      background:rgba(74,94,65,.12);
      border-color:rgba(74,94,65,.24);
    }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Find your state</h1>
    <p class="helper">Find your state or OCONUS chapter to open its landing page.</p>

    <div class="map-wrap" id="mapWrap">
      <div class="tip" id="tip"></div>
      <svg id="usMap" viewBox="0 0 1075 710"></svg>
    </div>

    <div class="directory" id="directory">
      <section class="dir-section">
        <h2>States</h2>
        <div class="dir-grid" id="statesList"></div>
      </section>
      <section class="dir-section">
        <h2>OCONUS</h2>
        <div class="dir-grid" id="oconusList"></div>
      </section>
    </div>
  </div>

  <script src="https://unpkg.com/d3@7"></script>
  <script src="https://unpkg.com/topojson-client@3"></script>

  <script>
    const BASE="https://irreverentwarriors.donordrive.com";
    const OPEN_IN_NEW_TAB=true;
    const OCONUS=[
      {name:"England",slug:"england"},
      {name:"France",slug:"france"},
      {name:"Germany",slug:"germany"},
      {name:"Puerto Rico",slug:"puertorico"}
    ];

    const FIFTY_STATES=["Alabama","Alaska","Arizona","Arkansas","California","Colorado","Connecticut","Delaware","Florida","Georgia",
    "Hawaii","Idaho","Illinois","Indiana","Iowa","Kansas","Kentucky","Louisiana","Maine","Maryland","Massachusetts","Michigan",
    "Minnesota","Mississippi","Missouri","Montana","Nebraska","Nevada","New Hampshire","New Jersey","New Mexico","New York",
    "North Carolina","North Dakota","Ohio","Oklahoma","Oregon","Pennsylvania","Rhode Island","South Carolina","South Dakota",
    "Tennessee","Texas","Utah","Vermont","Virginia","Washington","West Virginia","Wisconsin","Wyoming"];

    const slugify=s=>s.toLowerCase().replace(/&/g,"and").replace(/[^a-z0-9]/g,"");
    const tip=document.getElementById("tip"),wrap=document.getElementById("mapWrap");
    const svg=d3.select("#usMap"),main=svg.append("g"),insets=svg.append("g");
    const go=url=>OPEN_IN_NEW_TAB?window.open(url,"_blank","noopener"):window.location.href=url;
    const offsets=e=>{const r=wrap.getBoundingClientRect();return{x:e.clientX-r.left,y:e.clientY-r.top};};
    const projUS=d3.geoAlbersUsa().translate([487.5,305]).scale(1280);
    const pathUS=d3.geoPath(projUS);

    Promise.all([
      fetch("https://unpkg.com/us-atlas@3/states-10m.json").then(r=>r.json()),
      fetch("https://unpkg.com/world-atlas@2/countries-110m.json").then(r=>r.json())
    ]).then(([us,world])=>{
      const states=topojson.feature(us,us.objects.states).features.filter(f=>FIFTY_STATES.includes(f.properties.name));
      main.selectAll("path").data(states).join("path")
        .attr("class","state").attr("d",pathUS)
        .on("click",(_,d)=>go(`${BASE}/${slugify(d.properties.name)}`))
        .on("mousemove",(e,d)=>{const {x,y}=offsets(e);tip.textContent=d.properties.name;tip.style.left=x+"px";tip.style.top=y+"px";tip.style.opacity=1;})
        .on("mouseleave",()=>tip.style.opacity=0);

      const mesh=topojson.mesh(us,us.objects.states,(a,b)=>a!==b);
      main.append("path").attr("fill","none").attr("stroke","#BBA854").attr("stroke-width",.7).attr("d",pathUS(mesh));

      // Europe inset - off southeast coast
      const europe=insets.append("g");
      const layoutEU={x0:840,y0:320,x1:1070,y1:520,title:"Europe"};
      europe.append("rect").attr("class","inset-box").attr("x",layoutEU.x0).attr("y",layoutEU.y0)
        .attr("width",layoutEU.x1-layoutEU.x0).attr("height",layoutEU.y1-layoutEU.y0);
      europe.append("text").attr("class","inset-title").attr("x",layoutEU.x0+8).attr("y",layoutEU.y0+16).text(layoutEU.title);

      const countries=topojson.feature(world,world.objects.countries).features;
      const getName=f=>(f.properties?.name||f.properties?.NAME||f.properties?.admin)||"";
      const picks=["United Kingdom","France","Germany"];
      const targets=countries.filter(f=>picks.includes(getName(f))).map(f=>{
        let name=getName(f)==="United Kingdom"?"England":getName(f);
        if(name==="France"){
          const geom=f.geometry;
          if(geom.type==="MultiPolygon"){
            geom.coordinates=geom.coordinates.filter(poly=>{
              const avg=poly[0].reduce((a,b)=>[a[0]+b[0],a[1]+b[1]],[0,0]).map(v=>v/poly[0].length);
              return avg[0]>-5&&avg[0]<8&&avg[1]>41&&avg[1]<52;
            });
          }
        }
        return{name,geom:f.geometry};
      });
      const fc={type:"FeatureCollection",features:targets.map(t=>({type:"Feature",geometry:t.geom}))};
      const projEU=d3.geoMercator().fitExtent([[layoutEU.x0+8,layoutEU.y0+22],[layoutEU.x1-8,layoutEU.y1-8]],fc);
      const pathEU=d3.geoPath(projEU);
      europe.selectAll("path").data(targets).join("path").attr("class","inset-geom").attr("d",d=>pathEU({type:"Feature",geometry:d.geom}))
        .on("click",(_,d)=>go(`${BASE}/${slugify(d.name)}`))
        .on("mousemove",(e,d)=>{const {x,y}=offsets(e);tip.textContent=d.name;tip.style.left=x+"px";tip.style.top=y+"px";tip.style.opacity=1;})
        .on("mouseleave",()=>tip.style.opacity=0);

      // Puerto Rico inset
      const pr=insets.append("g");
      const layoutPR={x0:720,y0:600,x1:940,y1:670,title:"Puerto Rico"};
      pr.append("rect").attr("class","inset-box").attr("x",layoutPR.x0).attr("y",layoutPR.y0)
        .attr("width",layoutPR.x1-layoutPR.x0).attr("height",layoutPR.y1-layoutPR.y0);
      pr.append("text").attr("class","inset-title").attr("x",layoutPR.x0+8).attr("y",layoutPR.y0+16).text(layoutPR.title);
      const prState=topojson.feature(us,us.objects.states).features.find(f=>f.properties.name==="Puerto Rico");
      if(prState){
        const fcPR={type:"FeatureCollection",features:[prState]};
        const projPR=d3.geoMercator().fitExtent([[layoutPR.x0+6,layoutPR.y0+20],[layoutPR.x1-6,layoutPR.y1-6]],fcPR);
        const pathPR=d3.geoPath(projPR);
        pr.append("path").datum(prState).attr("class","inset-geom").attr("d",pathPR)
          .on("click",()=>go(`${BASE}/puertorico`))
          .on("mousemove",(e)=>{const {x,y}=offsets(e);tip.textContent="Puerto Rico";tip.style.left=x+"px";tip.style.top=y+"px";tip.style.opacity=1;})
          .on("mouseleave",()=>tip.style.opacity=0);
      }

      // Directory lists
      const statesList=document.getElementById("statesList");
      FIFTY_STATES.forEach(n=>{const a=document.createElement("a");a.textContent=n;a.href=`${BASE}/${slugify(n)}`;if(OPEN_IN_NEW_TAB)a.target="_blank";a.rel="noopener";statesList.appendChild(a);});
      const oconusList=document.getElementById("oconusList");
      OCONUS.forEach(({name,slug})=>{const a=document.createElement("a");a.textContent=name;a.href=`${BASE}/${slug}`;if(OPEN_IN_NEW_TAB)a.target="_blank";a.rel="noopener";oconusList.appendChild(a);});
    });
  </script>
</body>
</html>
